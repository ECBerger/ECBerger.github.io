<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloth Simulation</title>
    <style>
        .button {
            background-color: #606060;
            border: none;
            color: white;
            padding: 15px 32px;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        .button.disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
    </style>	
</head>
<body>	
    <h1>Cloth Simulation</h1> 
    <button type="button" id="buttonRun" class="button">Run</button>
    <button type="button" id="buttonRestart" class="button">Restart</button>
    <button type="button" id="buttonExport" class="button disabled" disabled>Export</button>
    <input title='checkboxEdges' id="checkboxEdges" type="checkbox" value="0"> Show Mesh&nbsp;&nbsp;
    <input title='checkboxGravity' id="checkboxGravity" type="checkbox"> Simulate Pulsatile Flow&nbsp;&nbsp;
    <input title='checkboxFixed' id="checkboxFixedVertices" type="checkbox" value="0"> Exclude Fixed Vertices from Mouse Interaction</p>
    <span id="numTris">0</span> tris&nbsp;&nbsp;
    <span id="numVerts">0</span> verts&nbsp;&nbsp;
    <span id="ms">0.000</span> ms per frame&nbsp;&nbsp;
    Bending compliance:
    <input title='Slider' type="range" min="0" max="1" value="0.05" step="0.05" id="bendingComplianceSlider" class="slider">
    <span id="bendingCompliance">0</span>/1</p>
    <div id="container"></div>
    <script src="https://unpkg.com/three@0.139.2/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.139.2/examples/js/controls/OrbitControls.js"></script>
    </script>
    <script>        
        //  ----- math on vector arrays -------------------------------------------------------------

        function vecSetZero(a,anr) {
            anr *= 3;
            a[anr++] = 0.0;
            a[anr++] = 0.0;
            a[anr]   = 0.0;
        }

        function vecScale(a,anr, scale) {
            anr *= 3;
            a[anr++] *= scale;
            a[anr++] *= scale;
            a[anr]   *= scale;
        }

        function vecCopy(a,anr, b,bnr) {
            anr *= 3; bnr *= 3;
            a[anr++] = b[bnr++]; 
            a[anr++] = b[bnr++]; 
            a[anr]   = b[bnr];
        }

        function vecAdd(a,anr, b,bnr, scale = 1.0) {
            anr *= 3; bnr *= 3;
            a[anr++] += b[bnr++] * scale; 
            a[anr++] += b[bnr++] * scale; 
            a[anr]   += b[bnr] * scale;
        }

        function vecSetDiff(dst,dnr, a,anr, b,bnr, scale = 1.0) {
            dnr *= 3; anr *= 3; bnr *= 3;
            dst[dnr++] = (a[anr++] - b[bnr++]) * scale;
            dst[dnr++] = (a[anr++] - b[bnr++]) * scale;
            dst[dnr]   = (a[anr] - b[bnr]) * scale;
        }

        function vecLengthSquared(a,anr) {
            anr *= 3;
            let a0 = a[anr], a1 = a[anr + 1], a2 = a[anr + 2];
            return a0 * a0 + a1 * a1 + a2 * a2;
        }

        function vecDistSquared(a,anr, b,bnr) {
            anr *= 3; bnr *= 3;
            let a0 = a[anr] - b[bnr], a1 = a[anr + 1] - b[bnr + 1], a2 = a[anr + 2] - b[bnr + 2];
            return a0 * a0 + a1 * a1 + a2 * a2;
        }	

        function vecDot(a,anr, b,bnr) {
            anr *= 3; bnr *= 3;
            return a[anr] * b[bnr] + a[anr + 1] * b[bnr + 1] + a[anr + 2] * b[bnr + 2];
        }	

        function vecSetCross(a,anr, b,bnr, c,cnr) {
            anr *= 3; bnr *= 3; cnr *= 3;
            a[anr++] = b[bnr + 1] * c[cnr + 2] - b[bnr + 2] * c[cnr + 1];
            a[anr++] = b[bnr + 2] * c[cnr + 0] - b[bnr + 0] * c[cnr + 2];
            a[anr]   = b[bnr + 0] * c[cnr + 1] - b[bnr + 1] * c[cnr + 0];
        }			

        var gThreeScene;
        var gRenderer;
        var gCamera;
        var gCameraControl;
        var gGrabber;
        var gMouseDown = false;
        var gravityArrow;
        var time = 0; // Initialize time
        var useSinusoidalGravity = false;
        var gravityConstant = -9.81;
        var maxVelocity = 4.0;

        // ------------------------------------------------------------------

        var gPhysicsScene = 
        {
            gravity : [0.0, gravityConstant, 0.0],
            dt : 1.0 / 60.0,
            numSubsteps : 15,
            paused: true,
            showEdges: false,
            objects: [],				
        };

        // ------------------------------------------------------------------
        function onShowEdges() 
        {
            gPhysicsScene.showEdges = !gPhysicsScene.showEdges;
            for (var i = 0; i < gPhysicsScene.objects.length; i++) {
                gPhysicsScene.objects[i].edgeMesh.visible = gPhysicsScene.showEdges;
                // gPhysicsScene.objects[i].triMesh.visible = !gPhysicsScene.showEdges;
            }
        }	

        // ------------------------------------------------------------------
        // Function to handle checkbox change
        function onGravityCheckboxChange() {
            useSinusoidalGravity = document.getElementById('checkboxGravity').checked;
        }

        // ------------------------------------------------------------------
        function findTriNeighbors(triIds) 
        {
            // create common edges

            var edges = [];
            var numTris = triIds.length / 3;

            for (var i = 0; i < numTris; i++) {
                for (var j = 0; j < 3; j++) {
                    var id0 = triIds[3 * i + j];
                    var id1 = triIds[3 * i + (j + 1) % 3];
                    edges.push({
                        id0 : Math.min(id0, id1), 
                        id1 : Math.max(id0, id1), 
                        edgeNr : 3 * i + j
                    });
                }
            }

            // sort so common edges are next to each other

            edges.sort((a, b) => ((a.id0 < b.id0) || (a.id0 == b.id0 && a.id1 < b.id1)) ? -1 : 1);

            // find matching edges

            var neighbors = new Float32Array(3 * numTris);
            neighbors.fill(-1);		// open edge

            var nr = 0;
            while (nr < edges.length) {
                var e0 = edges[nr];
                nr++;
                if (nr < edges.length) {
                    var e1 = edges[nr];
                    if (e0.id0 == e1.id0 && e0.id1 == e1.id1) {
                        neighbors[e0.edgeNr] = e1.edgeNr;
                        neighbors[e1.edgeNr] = e0.edgeNr;
                    }
                    nr++;
                }
            }

            return neighbors;
        }

        // ------------------------------------------------------------------
        function exportToSTL(geometry) {
            let stl = '';
            stl += 'solid exported\n';

            const positions = geometry.attributes.position.array;
            const indices = geometry.index.array;

            for (let i = 0; i < indices.length; i += 3) {
                const indexA = indices[i];
                const indexB = indices[i + 1];
                const indexC = indices[i + 2];

                const vertexA = new THREE.Vector3(
                    positions[3 * indexA],
                    positions[3 * indexA + 1],
                    positions[3 * indexA + 2]
                );
                const vertexB = new THREE.Vector3(
                    positions[3 * indexB],
                    positions[3 * indexB + 1],
                    positions[3 * indexB + 2]
                );
                const vertexC = new THREE.Vector3(
                    positions[3 * indexC],
                    positions[3 * indexC + 1],
                    positions[3 * indexC + 2]
                );

                // Calculate the normal vector for the face
                const normal = new THREE.Vector3();
                normal.crossVectors(
                    new THREE.Vector3().subVectors(vertexB, vertexA),
                    new THREE.Vector3().subVectors(vertexC, vertexA)
                ).normalize();

                stl += 'facet normal ' + normal.x + ' ' + normal.y + ' ' + normal.z + '\n';
                stl += 'outer loop\n';
                stl += 'vertex ' + vertexA.x + ' ' + vertexA.y + ' ' + vertexA.z + '\n';
                stl += 'vertex ' + vertexB.x + ' ' + vertexB.y + ' ' + vertexB.z + '\n';
                stl += 'vertex ' + vertexC.x + ' ' + vertexC.y + ' ' + vertexC.z + '\n';
                stl += 'endloop\n';
                stl += 'endfacet\n';
            }

            stl += 'endsolid exported\n';
            return stl;
        }


        // ------------------------------------------------------------------
        function saveSTLFile(stlString, filename = 'currentMesh.stl') {
            // Create a Blob from the STL string
            const blob = new Blob([stlString], { type: 'text/plain' });
            
            // Create a download link
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;  // Use the fixed filename provided
            
            // Trigger the download
            link.click();
            
            // Clean up the URL object
            URL.revokeObjectURL(link.href);
        }

        // ------------------------------------------------------------------
        function exportCurrentMesh() {
            if (gPhysicsScene.paused) {
                let combinedSTL = '';
                if (gPhysicsScene.objects.length > 0) {
                    // Assuming the first object in gPhysicsScene.objects is the cloth
                    let cloth = gPhysicsScene.objects[0];
                    let geometry = cloth.triMesh.geometry; // Access the geometry from the triMesh

                    if (geometry) {
                        combinedSTL += exportToSTL(geometry);
                    }
                }

                saveSTLFile(combinedSTL, 'currentMesh.stl');
            } else {
                console.log("Please pause the simulation before exporting.");
            }
        }

        // ------------------------------------------------------------------
        // Calculate Minimum Edge Length
        function calculateSelfCollideDist(mesh) {
            const positions = mesh.vertices;
            const indices = mesh.faceTriIds;
            let minEdgeLength = Infinity;
            let seenEdges = new Set();

            for (let i = 0; i < indices.length; i += 3) {
                for (let j = 0; j < 3; j++) {
                    const indexA = indices[i + j];
                    const indexB = indices[i + (j + 1) % 3];

                    const edge = indexA < indexB ? `${indexA}-${indexB}` : `${indexB}-${indexA}`;
                    if (seenEdges.has(edge)) continue;
                    seenEdges.add(edge);

                    const dx = positions[3 * indexA] - positions[3 * indexB];
                    const dy = positions[3 * indexA + 1] - positions[3 * indexB + 1];
                    const dz = positions[3 * indexA + 2] - positions[3 * indexB + 2];

                    const edgeLength = Math.sqrt(dx * dx + dy * dy + dz * dz);
                    if (edgeLength < minEdgeLength) {
                        minEdgeLength = edgeLength;
                    }
                }
            }

            // Using the minimum edge length as self-collision distance
            return minEdgeLength * 0.53; 
        }

        // ------------------------------------------------------------------
        function clampVelocity(vel, maxVel) {
            for (let i = 0; i < vel.length; i += 3) {
                let vx = vel[i];
                let vy = vel[i + 1];
                let vz = vel[i + 2];
                let speed = Math.sqrt(vx * vx + vy * vy + vz * vz);
                if (speed > maxVel) {
                    let scaleFactor = maxVel / speed;
                    vel[i] *= scaleFactor;
                    vel[i + 1] *= scaleFactor;
                    vel[i + 2] *= scaleFactor;
                }
            }
        }

        // ------------------------------------------------------------------
        // Hash class
        class Hash {
            constructor(spacing, maxNumObjects){
                this.spacing = spacing;
                this.tableSize = 5 * maxNumObjects;
                this.cellStart = new Int32Array(this.tableSize + 1);
                this.cellEntries = new Int32Array(maxNumObjects);
                this.queryIds = new Int32Array(maxNumObjects);
                this.querySize = 0;
                this.maxNumObjects = maxNumObjects;
                this.firstAdjId = new Int32Array(maxNumObjects + 1);
                this.adjIds = new Int32Array(10 * maxNumObjects);
            }

            hashCoords(xi, yi, zi) {
                var h = (xi * 92837111) ^ (yi * 689287499) ^ (zi * 283923481); // fantasy function
                return Math.abs(h) % this.tableSize;
            }

            intCoord(coord) {
                return Math.floor(coord / this.spacing);
            }

            hashPos(pos, nr) {
                return this.hashCoords(
                    this.intCoord(pos[3 * nr]),
                    this.intCoord(pos[3 * nr + 1]),
                    this.intCoord(pos[3 * nr + 2])
                );
            }

            create(pos) {
                var numObjects = Math.min(pos.length / 3, this.cellEntries.length);
                // Determine cell sizes
                this.cellStart.fill(0);
                for (var i = 0; i < numObjects; i++) {
                    var h = this.hashPos(pos, i);
                    this.cellStart[h]++;
                }
                // Determine cells starts
                var start = 0;
                for (var i = 0; i < this.tableSize; i++) {
                    var count = this.cellStart[i];
                    this.cellStart[i] = start;
                    start += count;
                }
                this.cellStart[this.tableSize] = start; // guard value
                // Fill in objects ids
                for (var i = 0; i < numObjects; i++) {
                    var h = this.hashPos(pos, i);
                    this.cellEntries[this.cellStart[h]++] = i;
                }
                // Correct last cell start values
                for (var i = this.tableSize; i > 0; --i) {
                    this.cellStart[i] = this.cellStart[i - 1];
                }
                this.cellStart[0] = 0;
            }

            query(pos, nr, maxDist) {
                var x0 = this.intCoord(pos[3 * nr] - maxDist);
                var y0 = this.intCoord(pos[3 * nr + 1] - maxDist);
                var z0 = this.intCoord(pos[3 * nr + 2] - maxDist);
                var x1 = this.intCoord(pos[3 * nr] + maxDist);
                var y1 = this.intCoord(pos[3 * nr + 1] + maxDist);
                var z1 = this.intCoord(pos[3 * nr + 2] + maxDist);
                this.querySize = 0;
                for (var xi = x0; xi <= x1; xi++) {
                    for (var yi = y0; yi <= y1; yi++) {
                        for (var zi = z0; zi <= z1; zi++) {
                            var h = this.hashCoords(xi, yi, zi);
                            var start = this.cellStart[h];
                            var end = this.cellStart[h + 1];
                            for (var i = start; i < end; i++) {
                                this.queryIds[this.querySize] = this.cellEntries[i];
                                this.querySize++;
                            }
                        }
                    }
                }
            }

            queryAll(pos, maxDist) {
                var num = 0;
                var maxDist2 = maxDist * maxDist;
                for (var i = 0; i < this.maxNumObjects; i++) {
                    var id0 = i;
                    this.firstAdjId[id0] = num;
                    this.query(pos, id0, maxDist);
                    for (var j = 0; j < this.querySize; j++) {
                        var id1 = this.queryIds[j];
                        if (id1 >= id0) continue;
                        var dist2 = vecDistSquared(pos, id0, pos, id1);
                        if (dist2 > maxDist2) continue;
                        if (num >= this.adjIds.length) {
                            var newIds = new Int32Array(2 * num); // dynamic array
                            newIds.set(this.adjIds);
                            this.adjIds = newIds;
                        }
                        this.adjIds[num++] = id1;
                    }
                }
                this.firstAdjId[this.maxNumObjects] = num;
            }
        }

        // ------------------------------------------------------------------
        class Cloth {
            constructor(mesh, scene, bendingCompliance = 0.05)
            {
                
                // Calculate a reasonable self-collision distance based on the mesh
                this.selfCollideDist = calculateSelfCollideDist(mesh); 

                // particles
                this.numParticles = mesh.vertices.length / 3;
                this.pos = new Float32Array(mesh.vertices);
                this.prevPos = new Float32Array(mesh.vertices);
                this.restPos = new Float32Array(mesh.vertices);
                this.vel = new Float32Array(3 * this.numParticles);
                this.invMass = new Float32Array(this.numParticles);

                var neighbors = findTriNeighbors(mesh.faceTriIds);
                var numTris = mesh.faceTriIds.length / 3;
                var edgeIds = [];
                var triPairIds = [];

                for (var i = 0; i < numTris; i++) {
                    for (var j = 0; j < 3; j++) {
                        var id0 = mesh.faceTriIds[3 * i + j];
                        var id1 = mesh.faceTriIds[3 * i + (j + 1) % 3];

                        // each edge only once
                        var n = neighbors[3 * i + j];
                        if (n < 0 || id0 < id1) {
                            edgeIds.push(id0);
                            edgeIds.push(id1);
                        }
                        // tri pair
                        if (n >= 0) {
                            // opposite ids
                            var ni = Math.floor(n / 3);
                            var nj = n % 3;
                            var id2 = mesh.faceTriIds[3 * i + (j + 2) % 3];
                            var id3 = mesh.faceTriIds[3 * ni + (nj + 2) % 3];
                            triPairIds.push(id0);
                            triPairIds.push(id1);
                            triPairIds.push(id2);
                            triPairIds.push(id3);
                        }
                    }
                }

                this.stretchingIds = new Int32Array(edgeIds);
                this.bendingIds = new Int32Array(triPairIds);
                this.stretchingLengths = new Float32Array(this.stretchingIds.length / 2);
                this.bendingLengths = new Float32Array(this.bendingIds.length / 4);

                this.stretchingCompliance = 0.0;		
                this.bendingCompliance = bendingCompliance;

                this.temp = new Float32Array(4 * 3);
                this.grads = new Float32Array(4 * 3);

            
                this.grabId = -1;
                this.grabInvMass = 0.0;

                this.initPhysics(mesh.faceTriIds);

                // visual edge mesh

                var geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.BufferAttribute(this.pos, 3));
                geometry.setIndex(edgeIds);
                var lineMaterial = new THREE.LineBasicMaterial({color: 0xff0000, linewidth: 2});
                // var lineMaterial = new THREE.MeshPhongMaterial({color: 0xff0000, side: THREE.DoubleSide});
                this.edgeMesh = new THREE.LineSegments(geometry, lineMaterial);
                this.edgeMesh.visible = true;
                scene.add(this.edgeMesh);

                // visual tri mesh
                geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.BufferAttribute(this.pos, 3));
                geometry.setIndex(mesh.faceTriIds);
                var visMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000, side: THREE.FrontSide });
                this.triMesh = new THREE.Mesh(geometry, visMaterial);
                this.triMesh.castShadow = true;
                this.triMesh.userData = this; // for raycasting
                this.triMesh.layers.enable(1);
                scene.add(this.triMesh);
                
                var backMaterial = new THREE.MeshPhongMaterial({color: 0xff8000, side: THREE.BackSide});
                this.backMesh = new THREE.Mesh(geometry, backMaterial);
                this.backMesh.userData = this;	// for raycasting
                this.backMesh.layers.enable(1);
                scene.add(this.backMesh);
                geometry.computeVertexNormals();
                
                this.updateMeshes();

                this.volIdOrder = [[1,3,2], [0,2,3], [0,3,1], [0,1,2]];

                // Initialize the hash with appropriate spacing and particle count
                this.hash = new Hash(4 * this.selfCollideDist, this.numParticles); 
            }

            // Add a method to handle self-collision constraints using spatial hashing
            solveSelfCollisions() {
                this.hash.create(this.pos); // Update the spatial hash table
                var selfCollideDist2 = this.selfCollideDist * this.selfCollideDist;
                var repulsionFactor = 0.5; // Adjust repulsion factor for stability
            
                for (var i = 0; i < this.numParticles; i++) {
                    if (this.invMass[i] === 0.0) continue; // Skip static particles
            
                    var particleId = i;
                    this.hash.query(this.pos, particleId, this.selfCollideDist); // Query hash table
            
                    for (var j = 0; j < this.hash.querySize; j++) {
                        var otherId = this.hash.queryIds[j];
                        if (particleId >= otherId) continue; // Avoid double-checking
                        if (this.invMass[otherId] === 0.0) continue; // Skip static particles
            
                        var distSquared = vecDistSquared(this.pos, particleId, this.pos, otherId);
                        if (distSquared >= selfCollideDist2) continue; // Check distance, include edge case
            
                        var dist = Math.sqrt(distSquared);
                        var overlap = this.selfCollideDist - dist;
                        var invMassSum = this.invMass[particleId] + this.invMass[otherId];
                        
                        if (invMassSum === 0.0) continue; // Avoid division by zero
            
                        // Avoid division by very small numbers
                        var safeDist = Math.max(dist, 1e-3);
                        vecSetDiff(this.grads, 0, this.pos, particleId, this.pos, otherId);
                        vecScale(this.grads, 0, repulsionFactor * overlap / safeDist);
            
                        // Apply position correction
                        vecAdd(this.pos, particleId, this.grads, 0, -this.invMass[particleId] / invMassSum);
                        vecAdd(this.pos, otherId, this.grads, 0, this.invMass[otherId] / invMassSum);
            
                        // Calculate relative velocities for damping
                        vecSetDiff(this.grads, 1, this.vel, particleId, this.vel, otherId);
                        var relativeNormalVelocity = vecDot(this.grads, 0, this.grads, 1);
            
                        // Apply damping
                        if (relativeNormalVelocity < 0) {
                            vecScale(this.grads, 0, 0.5 * relativeNormalVelocity / invMassSum);
                            vecAdd(this.vel, particleId, this.grads, 0, -this.invMass[particleId]);
                            vecAdd(this.vel, otherId, this.grads, 0, this.invMass[otherId]);
                        }
                    }
                }
            }
            

            initPhysics(triIds) 
            {
                this.invMass.fill(0.0);

                var numTris = triIds.length / 3;
                var e0 = [0.0, 0.0, 0.0];
                var e1 = [0.0, 0.0, 0.0];
                var c = [0.0, 0.0, 0.0];

                for (var i = 0; i < numTris; i++) {
                    var id0 = triIds[3 * i];
                    var id1 = triIds[3 * i + 1];
                    var id2 = triIds[3 * i + 2];
                    vecSetDiff(e0,0, this.pos,id1, this.pos,id0);
                    vecSetDiff(e1,0, this.pos,id2, this.pos,id0);
                    vecSetCross(c,0, e0,0, e1,0);
                    var A = 0.5 * Math.sqrt(vecLengthSquared(c,0));
                    var pInvMass = A > 0.0 ? 1.0 / A / 3.0 : 0.0;
                    this.invMass[id0] += pInvMass;
                    this.invMass[id1] += pInvMass;
                    this.invMass[id2] += pInvMass;
                }

                for (var i = 0; i < this.stretchingLengths.length; i++) {
                    var id0 = this.stretchingIds[2 * i];
                    var id1 = this.stretchingIds[2 * i + 1];
                    this.stretchingLengths[i] = Math.sqrt(vecDistSquared(this.pos,id0, this.pos,id1));
                }

                for (var i = 0; i < this.bendingLengths.length; i++) {
                    var id0 = this.bendingIds[4 * i + 2];
                    var id1 = this.bendingIds[4 * i + 3];
                    this.bendingLengths[i] = Math.sqrt(vecDistSquared(this.pos,id0, this.pos,id1));
                }

                // Attach vertices based on their y-value, accounting for float precision limitations
                var epsilon = 0.001;

                for (var i = 0; i < this.numParticles; i++) {
                    var y = this.pos[3 * i + 1];
                    if (Math.abs(y - 2.1) < epsilon) {
                        this.invMass[i] = 0.0;
                    }
                }
            }

            preSolve(dt, gravity)
            {
                for (var i = 0; i < this.numParticles; i++) {
                    if (this.invMass[i] == 0.0)
                        continue;
                    vecAdd(this.vel,i, gravity,0, dt);            
                    vecCopy(this.prevPos,i, this.pos,i);
                    vecAdd(this.pos,i, this.vel,i, dt);
                    var y = this.pos[3 * i + 1];
                    if (y < 0.0) {
                        vecCopy(this.pos,i, this.prevPos,i);
                        this.pos[3 * i + 1] = 0.0;
                    }
                }
            }

            solve(dt)
            {
                this.solveStretching(this.stretchingCompliance, dt);
                this.solveBending(this.bendingCompliance, dt);
                this.solveSelfCollisions(); // Add this line to include self-collision
            }

            postSolve(dt)
            {
                for (var i = 0; i < this.numParticles; i++) {
                    if (this.invMass[i] == 0.0)
                        continue;
                    vecSetDiff(this.vel,i, this.pos,i, this.prevPos,i, 1.0 / dt);
                }
                clampVelocity(this.vel, maxVelocity); // Clamp the velocity to a maximum value
            }

            solveStretching(compliance, dt) {
                var alpha = compliance / dt /dt;

                for (var i = 0; i < this.stretchingLengths.length; i++) {
                    var id0 = this.stretchingIds[2 * i];
                    var id1 = this.stretchingIds[2 * i + 1];
                    var w0 = this.invMass[id0];
                    var w1 = this.invMass[id1];
                    var w = w0 + w1;
                    if (w == 0.0)
                        continue;

                    vecSetDiff(this.grads,0, this.pos,id0, this.pos,id1);
                    var len = Math.sqrt(vecLengthSquared(this.grads,0));
                    if (len == 0.0)
                        continue;
                    vecScale(this.grads,0, 1.0 / len);
                    var restLen = this.stretchingLengths[i];
                    var C = len - restLen;
                    var s = -C / (w + alpha);
                    vecAdd(this.pos,id0, this.grads,0, s * w0);
                    vecAdd(this.pos,id1, this.grads,0, -s * w1);
                }
            }

            solveBending(compliance, dt) {
                var alpha = compliance / dt /dt;

                for (var i = 0; i < this.bendingLengths.length; i++) {
                    var id0 = this.bendingIds[4 * i + 2];
                    var id1 = this.bendingIds[4 * i + 3];
                    var w0 = this.invMass[id0];
                    var w1 = this.invMass[id1];
                    var w = w0 + w1;
                    if (w == 0.0)
                        continue;

                    vecSetDiff(this.grads,0, this.pos,id0, this.pos,id1);
                    var len = Math.sqrt(vecLengthSquared(this.grads,0));
                    if (len == 0.0)
                        continue;
                    vecScale(this.grads,0, 1.0 / len);
                    var restLen = this.bendingLengths[i];
                    var C = len - restLen;
                    var s = -C / (w + alpha);
                    vecAdd(this.pos,id0, this.grads,0, s * w0);
                    vecAdd(this.pos,id1, this.grads,0, -s * w1);
                }
            }

            updateMeshes() {
                this.triMesh.geometry.computeVertexNormals();
                this.triMesh.geometry.attributes.position.needsUpdate = true;
                this.triMesh.geometry.computeBoundingSphere();

                this.edgeMesh.geometry.attributes.position.needsUpdate = true;
            }

            endFrame() 
            {
                this.updateMeshes();
            }

            startGrab(pos) 
            {
                var p = [pos.x, pos.y, pos.z];
                var minD2 = Number.MAX_VALUE;
                this.grabId = -1;
                for (let i = 0; i < this.numParticles; i++) {
                    var d2 = vecDistSquared(p,0, this.pos,i);
                    if (d2 < minD2) {
                        minD2 = d2;
                        this.grabId = i;
                    }
                }

                if (this.grabId >= 0) {
                    this.grabInvMass = this.invMass[this.grabId];
                    this.invMass[this.grabId] = 0.0;
                    vecCopy(this.pos,this.grabId, p,0);	
                }
            }

            moveGrabbed(pos, vel) 
            {
                if (this.grabId >= 0) {
                    var p = [pos.x, pos.y, pos.z];
                    vecCopy(this.pos,this.grabId, p,0);
                }
            }

            endGrab(pos, vel) 
            {
                if (this.grabId >= 0) {
                    this.invMass[this.grabId] = this.grabInvMass;
                    var v = [vel.x, vel.y, vel.z];
                    vecCopy(this.vel,this.grabId, v,0);
                }
                this.grabId = -1;
            }								
        }

        // ------------------------------------------------------------------
        function initPhysics() 
        {
            var mesh = meshes[0];

            var body = new Cloth(mesh, gThreeScene);
            gPhysicsScene.objects.push(body); 
            document.getElementById("numTris").innerHTML = mesh.faceTriIds.length / 3;
            document.getElementById("numVerts").innerHTML = mesh.vertices.length / 3;
        }

        var timeFrames = 0;
        var timeSum = 0;	

        // ------------------------------------------------------------------
        function simulate() {
            if (gPhysicsScene.paused)
                return;

            var startTime = performance.now();
            var sdt = gPhysicsScene.dt / gPhysicsScene.numSubsteps;

            // Update time
            time += sdt;

            // Determine the gravity magnitude based on the checkboxGravity state
            var gravityMagnitude;
            if (useSinusoidalGravity) {
                var amplitude = -2;   // Amplitude of the sinusoidal function
                var frequency = 2;   // Frequency in Hz
                gravityMagnitude = amplitude * Math.sin(2 * Math.PI * frequency * time) + 0.5 * amplitude;
            } else {
                gravityMagnitude = gravityConstant; // Constant gravity
            }

            // Update gravity vector in the scene
            gPhysicsScene.gravity = [0.0, gravityMagnitude, 0.0];

            // Update visual arrow representing gravity direction
            gravityArrow.setDirection(new THREE.Vector3(0, Math.sign(gravityMagnitude), 0));
            gravityArrow.setLength(Math.abs(gravityMagnitude));

            for (var step = 0; step < gPhysicsScene.numSubsteps; step++) {
                for (var i = 0; i < gPhysicsScene.objects.length; i++)
                    gPhysicsScene.objects[i].preSolve(sdt, gPhysicsScene.gravity);

                for (var i = 0; i < gPhysicsScene.objects.length; i++)
                    gPhysicsScene.objects[i].solve(sdt);

                for (var i = 0; i < gPhysicsScene.objects.length; i++)
                    gPhysicsScene.objects[i].postSolve(sdt);
            }
            for (var i = 0; i < gPhysicsScene.objects.length; i++)
                gPhysicsScene.objects[i].endFrame();

            gGrabber.increaseTime(gPhysicsScene.dt);

            var endTime = performance.now();
            timeSum += endTime - startTime;
            timeFrames++;

            if (timeFrames > 10) {
                timeSum /= timeFrames;
                document.getElementById("ms").innerHTML = timeSum.toFixed(3);
                timeFrames = 0;
                timeSum = 0;
            }

            document.getElementById("bendingCompliance").innerHTML = gPhysicsScene.objects[0].bendingCompliance;
        }

        // ------------------------------------------
                
        function initThreeScene() 
        {
            gThreeScene = new THREE.Scene();
            
            // Lights
            
            gThreeScene.add( new THREE.AmbientLight( 0xffffff, 1.0 ) );	
            gThreeScene.fog = new THREE.Fog( 0x000000, 0, 15 );				

            var spotLight = new THREE.SpotLight( 0xffffff );
            spotLight.angle = Math.PI / 5;
            spotLight.penumbra = 0.2;
            spotLight.position.set( 2, 3, 3 );
            spotLight.castShadow = true;
            spotLight.shadow.camera.near = 3;
            spotLight.shadow.camera.far = 10;
            spotLight.shadow.mapSize.width = 1024;
            spotLight.shadow.mapSize.height = 1024;
            gThreeScene.add( spotLight );

            var dirLight = new THREE.DirectionalLight( 0x55505a, 1 );
            dirLight.position.set( 0, 3, 0 );
            dirLight.castShadow = true;
            dirLight.shadow.camera.near = 1;
            dirLight.shadow.camera.far = 10;

            dirLight.shadow.camera.right = 1;
            dirLight.shadow.camera.left = - 1;
            dirLight.shadow.camera.top	= 1;
            dirLight.shadow.camera.bottom = - 1;

            dirLight.shadow.mapSize.width = 1024;
            dirLight.shadow.mapSize.height = 1024;
            gThreeScene.add( dirLight );

            const axesHelper = new THREE.AxesHelper(5);
            var colors = axesHelper.geometry.attributes.color;
            colors.setXYZ(0, 1, 0, 0); // x axis
            colors.setXYZ(1, 1, 0, 0); // (index, R, G, B)
            colors.setXYZ(2, 0, 1, 0); // y axis
            colors.setXYZ(3, 0, 1, 0);
            colors.setXYZ(4, 0, 0, 1); // z axis
            colors.setXYZ(5, 0, 0, 1);
            
            gThreeScene.add(axesHelper);
            
            // Geometry

            var ground = new THREE.Mesh(
                new THREE.BufferGeometry( 20, 20, 1, 1 ),
                new THREE.MeshPhongMaterial( { color: 0xa0adaf, shininess: 150 } )
            );				

            // ground.rotation.x = - Math.PI / 2; // rotates X/Y to X/Z
            ground.receiveShadow = true;
            gThreeScene.add( ground );
            
            var helper = new THREE.GridHelper( 20, 20 );
            helper.material.opacity = 1.0;
            helper.material.transparent = true;
            helper.position.set(0, 0.002, 0);
            gThreeScene.add( helper );				
            
            // Renderer

            gRenderer = new THREE.WebGLRenderer();
            gRenderer.shadowMap.enabled = true;
            gRenderer.setPixelRatio( window.devicePixelRatio );
            gRenderer.setSize( 0.8 * window.innerWidth, 0.8 * window.innerHeight );
            window.addEventListener( 'resize', onWindowResize, false );
            container.appendChild( gRenderer.domElement );
            
            // Camera
                    
            gCamera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 100);
            gCamera.position.set(0, 1, 1);
            gCamera.updateMatrixWorld();	

            gThreeScene.add(gCamera);

            gCameraControl = new THREE.OrbitControls(gCamera, gRenderer.domElement);
            gCameraControl.zoomSpeed = 2.0;
            gCameraControl.panSpeed = 0.4;
            gCameraControl.target = new THREE.Vector3(0.0, 0.6, 0.0);
            gCameraControl.update();

            // grabber

            gGrabber = new Grabber();
            container.addEventListener( 'pointerdown', onPointer, false );
            container.addEventListener( 'pointermove', onPointer, false );
            container.addEventListener( 'pointerup', onPointer, false );

            // Visual arrow to represent gravity
            gravityArrow = new THREE.ArrowHelper(new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 0), 1, 0xff0000);
            gThreeScene.add(gravityArrow);
        }

        // ------- grabber -----------------------------------------------------------

        class Grabber {
            constructor() {
                this.raycaster = new THREE.Raycaster();
                this.raycaster.layers.set(1);
                this.raycaster.params.Line.threshold = 0.1;
                this.physicsObject = null;
                this.distance = 0.0;
                this.prevPos = new THREE.Vector3();
                this.vel = new THREE.Vector3();
                this.time = 0.0;
            }
            increaseTime(dt) {
                this.time += dt;
            }
            updateRaycaster(x, y) {
                var rect = gRenderer.domElement.getBoundingClientRect();
                this.mousePos = new THREE.Vector2();
                this.mousePos.x = ((x - rect.left) / rect.width ) * 2 - 1;
                this.mousePos.y = -((y - rect.top) / rect.height ) * 2 + 1;
                this.raycaster.setFromCamera( this.mousePos, gCamera );
            }
            start(x, y) {
                this.physicsObject = null;
                this.updateRaycaster(x, y);
                var intersects = this.raycaster.intersectObjects( gThreeScene.children );
                if (intersects.length > 0) {
                    var obj = intersects[0].object.userData;
                    if (obj) {
                        this.physicsObject = obj;
                        this.distance = intersects[0].distance;
                        var pos = this.raycaster.ray.origin.clone();
                        pos.addScaledVector(this.raycaster.ray.direction, this.distance);
                        this.physicsObject.startGrab(pos);
                        this.prevPos.copy(pos);
                        this.vel.set(0.0, 0.0, 0.0);
                        this.time = 0.0;
                        if (gPhysicsScene.paused)
                            run();
                    }
                }
            }
            move(x, y) {
                if (this.physicsObject) {
                    this.updateRaycaster(x, y);
                    var pos = this.raycaster.ray.origin.clone();
                    pos.addScaledVector(this.raycaster.ray.direction, this.distance);

                    this.vel.copy(pos);
                    this.vel.sub(this.prevPos);
                    if (this.time > 0.0)
                        this.vel.divideScalar(this.time);
                    else
                        this.vel.set(0.0, 0.0, 0.0);
                    this.prevPos.copy(pos);
                    this.time = 0.0;

                    this.physicsObject.moveGrabbed(pos, this.vel);
                }
            }
            end(x, y) {
                if (this.physicsObject) { 
                    this.physicsObject.endGrab(this.prevPos, this.vel);
                    this.physicsObject = null;
                }
            }
        }			

        function onPointer( evt ) 
        {
            event.preventDefault();
            if (evt.type == "pointerdown") {
                gGrabber.start(evt.clientX, evt.clientY);
                gMouseDown = true;
                if (gGrabber.physicsObject) {
                    gCameraControl.saveState();
                    gCameraControl.enabled = false;
                }
            }
            else if (evt.type == "pointermove" && gMouseDown) {
                gGrabber.move(evt.clientX, evt.clientY);
            }
            else if (evt.type == "pointerup") {
                if (gGrabber.physicsObject) {
                    gGrabber.end();
                    gCameraControl.reset();
                }
                gMouseDown = false;
                gCameraControl.enabled = true;
            }
        }	


        // ------------------------------------------------------

        function onWindowResize() {

            gCamera.aspect = window.innerWidth / window.innerHeight;
            gCamera.updateProjectionMatrix();
            gRenderer.setSize( window.innerWidth, window.innerHeight );
        }

        function run() {
            var button = document.getElementById('buttonRun');
            if (gPhysicsScene.paused)
                button.innerHTML = "Stop";
            else
                button.innerHTML = "Run";
            gPhysicsScene.paused = !gPhysicsScene.paused;
        }

        function restart() {
            location.reload();
        }

        // Event Listeners for webpage inputs -----------------------------------
        document.getElementById('checkboxEdges').addEventListener('click', function() {
            onShowEdges();
        });

        // document.getElementById('checkboxCollisions').addEventListener('click', function() {
        //     activateSelfCollisions = this.checked;
        // });

        document.getElementById("buttonRestart").addEventListener('click', function() {
            restart();
        })

        document.getElementById("buttonRun").addEventListener('click', function() {
            run();
        })

        document.getElementById("buttonExport").addEventListener('click', function() {
            exportCurrentMesh();
        })

        document.getElementById("bendingComplianceSlider").oninput = function() {
            for (var i = 0; i < gPhysicsScene.objects.length; i++) 
                gPhysicsScene.objects[i].bendingCompliance = this.value;
        }

        document.getElementById('checkboxGravity').addEventListener('change', function() {
            onGravityCheckboxChange()
        });

        // make browser to call us repeatedly -----------------------------------

        function update() {
            simulate();
            gRenderer.render(gThreeScene, gCamera);
            requestAnimationFrame(update);
        }

        var meshes = [
    {
        name : "cloth",
        vertices : [2.6179240000000004, 1.618,
            2.615234597185266, 1.5143343840712067,
            2.6071774400741043, 1.4110947523944697,
            2.5937856372533394, 1.30870533876118,
            2.5751142185132947, 1.2075868832344174,
            2.5512399087185793, 1.1081549032377818,
            2.5222608125291637, 1.010817986105173,
            2.4882960112672867, 0.9159761101077911,
            2.449485073586761, 0.824019000857629,
            2.405987481955434, 0.7353245298413326,
            2.3579819773075243, 0.6502571616652125,
            2.3056658245587793, 0.5691664563919987,
            2.249254002002622, 0.492385633123559,
            2.1889783179182345, 0.4202302007321397,
            2.125086458020612, 0.3529966613667279,
            2.057840967666836, 0.29096129206212584,
            1.987518173000882, 0.23437900945735013,
            1.9144070454702244, 0.18348232228848582,
            1.8388080143801755, 0.13848037596041562,
            1.7610317323654245, 0.09955809312348807,
            1.6813977988517301, 0.06687541378668316,
            1.6002334467533257, 0.040566638089809315,
            1.5178721978026828, 0.020739874435419692,
            1.4346524920381714, 0.007476595248197215,
            1.350916297081349, 0.0008313021872869975,
            1.2670077029186515, 0.0008313021872869975,
            1.18327150796183, 0.007476595248197215,
            1.1000518021973185, 0.020739874435419692,
            1.0176905532466751, 0.040566638089809315,
            0.9365262011482711, 0.06687541378668294,
            0.8568922676345767, 0.09955809312348762,
            0.7791159856198253, 0.1384803759604154,
            0.7035169545297761, 0.1834823222884856,
            0.6304058269991187, 0.2343790094573499,
            0.560083032333165, 0.2909612920621252,
            0.49283754197938867, 0.3529966613667277,
            0.42894568208176675, 0.420230200732139,
            0.36866999799737865, 0.492385633123559,
            0.3122581754412218, 0.5691664563919974,
            0.259942022692476, 0.6502571616652122,
            0.21193651804456692, 0.7353245298413316,
            0.16843892641324, 0.8240190008576287,
            0.12962798873271386, 0.9159761101077908,
            0.09566318747083691, 1.010817986105172,
            0.0666840912814215, 1.1081549032377809,
            0.04280978148670633, 1.2075868832344157,
            0.024138362746661146, 1.3087053387611793,
            0.010746559925896237, 1.4110947523944686,
            0.0026894028147341764, 1.5143343840712067,
            0.0, 1.6179999999999999,
            0.8625453621022541, 0.36463446916026276,
            0.799842743109045, 0.2592999752222004,
            1.04102536824505, 0.2509092655670694,
            1.1649178486023046, 0.16002792444833117,
            1.3089620000000002, 0.14006829860710981,
            1.4542914397136264, 0.15196345457143412,
            1.5972881149304259, 0.18800633117642052,
            1.7354121338904265, 0.2479215437702052,
            1.6179240000000004, 1.618,
            0.6738226873017252, 0.48171779939851866,
            1.866269584235717, 0.3305889288395517,
            0.8089620000000002, 1.6179999999999999,
            2.2745384435807665, 1.1375520398212706,
            0.4650987541939987, 0.8221108999851205,
            0.5238224099263331, 0.560739953029625,
            1.9876507194219353, 0.4345108391986183,
            2.410161013867967, 1.0971745589477582,
            2.4929240000000004, 1.5693751882946547,
            2.152825245806, 0.8221108999851224,
            0.3168894002538881, 0.8418088725060469,
            0.4044842903088065, 0.6860880769520845,
            2.097569252422967, 0.5578432103541213,
            0.4044810000000001, 1.6179999999999999,
            2.3679240000000004, 1.618,
            2.3816722843665046, 1.468361361706266,
            2.271352269873295, 0.7552233292660522,
            0.28054186823788796, 1.0235241146312826,
            0.18406097020816753, 1.1889200919388236,
            2.302207761321637, 0.9403468202937557,
            0.20575458311036407, 1.384529923941914,
            0.20224050000000005, 1.6179999999999999,
            0.10112025000000002, 1.5687556746180151,
            0.9205615494023378, 0.25876930104951584,
            0.7347919813672403, 0.3693526247980214,
            0.19659249738687654, 1.5011535046866544,
            0.9750419358873813, 0.1666907732135247,
            0.0993498621627922, 1.465038225711442,
            0.3591725671491351, 1.45525430377043,
            1.2286632885378932, 0.0903174840885866,
            1.2776077007977267, 0.44353835033681244,
            1.3864070266052506, 0.08761232950731304,
            1.5401240265099936, 0.11311512639904833,
            2.1179240000000004, 1.618,
            2.153102921961111, 0.6841422303512137,
            2.3203397077176158, 1.043434575837795,
            2.152284038137787, 1.0198551506537155,
            2.4127823667791763, 0.9908593086753079,
            2.3883635440541804, 0.8980302699765944,
            2.2490036050009494, 0.8540814648686985,
            0.624155559919632, 0.3820448947330689,
            0.7101667972067798, 0.28054530697092567,
            1.0687427159407636, 0.12810266085783367,
            0.10728833058780432, 1.3649605324516514,
            1.2560492967963004, 0.2879561748703361,
            1.4766742605167036, 0.3648460212374808,
            1.8263220623310976, 0.7524691644634786,
            2.2002825636358914, 0.5880387603300401,
            2.3484429914404674, 0.8113987973648404,
            0.5397696910705219, 0.4521790803479971,
            0.12249836882275382, 1.266832951023384,
            1.2438886467486154, 0.20019548584251226,
            1.3733994288982734, 0.24653306097522026,
            1.504538227014231, 0.25429839178030644,
            1.622508217394028, 0.3428186197715837,
            1.9824974252091954, 0.6837988692207151,
            2.262981597999527, 0.6600836251196429,
            1.7463369247354452, 0.37553165443419745,
            1.5890388213118718, 0.6149978071916438,
            2.0678760742091247, 0.6462578837143792,
            1.5677775264820808, 0.47423591304973955,
            1.7120823496381312, 0.5244261254130665,
            1.4109472192628587, 0.5699108983308119,
            1.6618496716589461, 0.43630830759769806,
            1.4589571165005162, 0.47223315033111385,
            1.6899020655859, 0.16366906596010658,
            1.8330399804185156, 0.23828598258531983,
            0.7145325431946165, 0.7408702107595402,
            1.9671839100306148, 0.33556840133540866,
            0.3836734373317202, 0.7768787195061155,
            0.4214772263743302, 0.582784062178529,
            0.5482940869863953, 0.7035204976963336,
            0.6472106403887827, 0.6130794124796619,
            0.6065484611762558, 0.8328654126980729,
            0.8528659081935253, 0.5863659038749287,
            0.9083625924023149, 1.0777616882792538,
            0.5184312853749734, 1.0562422580080852,
            0.7550002705083427, 0.637922831579873,
            0.7972794970798676, 0.4759818665041735,
            0.7801828009261158, 0.9273040902285373,
            0.5279587008446734, 0.9309320591680912,
            0.7115195475624645, 0.8467070783558739,
            0.654583415389878, 0.9647595990446888,
            0.40706822922419794, 0.9847579656179067,
            0.75652544617694, 1.077287666784489,
            0.3234201293795415, 0.9376080021471842,
            2.0901873947035727, 0.4537742157797152,
            2.4728328046470005, 1.1819686058913117,
            2.4980492233056397, 1.3732974596372785,
            2.5226650844694096, 1.472046734797656,
            0.30336075000000007, 1.5584721105885901,
            0.3518775678123967, 1.269316670886223,
            0.3815844627973644, 1.1274468598581295,
            0.290356014177495, 1.1823891865315745,
            0.5966716353020813, 1.3433143606570626,
            1.1286441150072188, 0.38489492372540013,
            1.1487950864201464, 0.26793669107333007,
            1.3604787377858727, 0.3620420117668383,
            1.9716880459357369, 0.8711436000598226,
            1.972244280977284, 0.5588896361426445,
            1.8658754574326921, 0.6304963253085857,
            1.8502470338080161, 0.48063461956850506,
            1.7351525292573322, 0.6555050622697141,
            1.799896785410481, 0.5616311902920249,
            1.5944928365592403, 0.87910161452598,
            1.6939253459246884, 0.7856111861498623,
            1.8009080709432521, 0.9319667552891623,
            1.564529176590083, 0.7476121757421426,
            1.7009786771457762, 0.892734157506219,
            1.6452562927366934, 1.1815461396849865,
            1.6999202979991344, 1.0423113905959869,
            1.6457923800734189, 0.694059046118918,
            1.2268976673884802, 0.8937100116557098,
            1.4819368755955196, 0.6637754483130477,
            1.398947341316992, 0.8281346682144108,
            1.4681591764842128, 0.759950175596282,
            1.3368253451956347, 0.6958570990796487,
            1.2892866069704747, 0.7989089638058743,
            1.0597921205108112, 0.715807472830633,
            1.16460730655441, 0.7847867558413846,
            1.2781235032910163, 0.5765256758770407,
            1.0358317195787845, 0.9307028874840122,
            1.2193346778028205, 0.6795493339622227,
            1.1134644512454397, 0.5508508720392162,
            1.1250656609332503, 0.879672330565194,
            1.1553715867662315, 1.0362005894225053,
            1.204115838805524, 0.510318057747674,
            0.6359476798597934, 1.0840821541188308,
            0.7077793783707393, 1.2855284584211555,
            0.5387888502228415, 1.2322570589678028,
            0.7015080378713289, 1.1742346709692093,
            0.560512106040917, 1.140559924393142,
            0.8495756729823348, 1.2217147323705457,
            0.4378973065141512, 1.2132836639798004,
            0.832647216925823, 1.0124370189753842,
            0.9082986851715632, 0.9070832447700258,
            0.8343483096108016, 0.7972424830973054,
            0.9584507305129333, 0.9924037000289924,
            0.9909518853406521, 0.8169154021275411,
            0.9263806782093454, 0.6989623114098521,
            0.9847898062037848, 0.5805294048597521,
            0.8293372418404112, 0.700319016431041,
            0.9213415326507737, 0.4738989983478396,
            0.9894096649642887, 0.3668193348166338,
            1.0479493725933398, 0.46118613568727485,
            1.9901584656323168, 1.3106012731787637,
            2.2429240000000004, 1.618,
            2.340338747174361, 1.2989948736887953,
            2.365363803015472, 1.1946645039326118,
            0.30816313343729573, 1.364143665643681,
            0.2385545654769506, 1.281884471391982,
            0.6067215000000001, 1.6179999999999999,
            0.47300973400578195, 1.363110199482761,
            0.49397706736986763, 1.5054044914999165,
            0.7283998049437361, 1.4608854088030163,
            0.5056012500000001, 1.6179999999999999,
            0.6848331001537784, 1.3771176029048013,
            0.6086801399535204, 1.4699370934976652,
            1.2196326064866112, 0.3722870099145038,
            1.9292875087579087, 0.7747129781065634,
            2.044699057185699, 0.7812323583764635,
            1.5111946975007053, 1.0485651253820092,
            1.1279983047496782, 0.6467898361775017,
            0.8322781022408099, 1.1306707299383902,
            1.0599067876340775, 1.2236287446185363,
            1.0369391286725265, 1.0958356315545337,
            2.109540948161995, 1.1865960040063985,
            1.8428844347948805, 1.1787875710256372,
            2.1804240000000004, 1.4245379882700462,
            2.1804240000000004, 1.5313646453821852,
            1.8679240000000004, 1.618,
            2.274188415560168, 1.4779513168261156,
            2.2707524564423798, 1.3749769451382052,
            2.169844475902748, 1.298160591718332,
            2.0844711941096756, 1.3689390321729733,
            2.2053590324294894, 1.2068839635497113,
            2.444200687430873, 1.2830683516899484,
            2.4014504378804475, 1.3738076190420045,
            0.8267453596873832, 1.360429976203103,
            1.2134430000000003, 1.6179999999999999,
            1.0112025000000002, 1.6179999999999999,
            0.9539453724031738, 1.3101286920462227,
            1.1335744229418798, 1.422021444448089,
            0.8608473084474192, 1.4921833892782688,
            1.0628653928114675, 1.3354037166340145,
            1.2250406981968163, 1.2751844078422923,
            0.9980756191282948, 1.4604638075612002,
            0.9100822500000002, 1.6179999999999999,
            0.916977307887374, 1.4026251961188718,
            1.0915704594430828, 1.5319882468624306,
            0.7078417500000002, 1.5706386336347855,
            1.6069062767679658, 1.0861417957676307,
            1.333490561756503, 1.0364137942900464,
            0.9551219248209307, 1.1808371570872327,
            1.7435065097987774, 1.139771481647798,
            1.834852982291232, 1.0531736359268091,
            1.909567878379862, 0.9668924534621616,
            2.0339407442454536, 0.9795577142080306,
            2.0727033453351407, 0.8852195748579719,
            2.063727276311326, 1.0860030208261642,
            1.9483725472043254, 1.07598537039508,
            1.96124870429202, 1.1947211424748136,
            1.9541177628299882, 1.474272103543231,
            2.064543638682333, 1.5136287539062936,
            1.9929240000000004, 1.618,
            1.1698819633830693, 1.1616174499856247,
            1.2443674611596716, 1.089451853142194,
            1.3682460475589497, 1.1962141002267415,
            1.4156835000000003, 1.6179999999999999,
            1.7429240000000004, 1.4453281843615295,
            1.269185044212262, 1.18590611445852,
            1.4182973545244184, 1.1016485849389834,
            1.5078468941737841, 1.2095733022299113,
            1.6071599239479124, 1.3456238695230205,
            1.4258493681520017, 1.3303508550889744,
            1.5886478009835465, 1.254864068969584,
            1.3145121135081732, 1.342564014348269,
            1.2406887363486516, 1.4201972092800474,
            1.3770060511172766, 1.4759079469363021,
            1.3145632500000004, 1.5692149001431102,
            1.5168037500000005, 1.5141650473743566,
            1.5168037500000002, 1.6179999999999999,
            1.4661159288050665, 1.4248362595191753,
            1.6358445195056885, 1.4993922646032045,
            1.842333900752143, 1.504944400973731,
            1.7429240000000004, 1.618,
            1.8590961434154816, 1.3643024048632015,
            1.745457656082826, 1.2807855419931606,
            1.8911246305326639, 1.268037741459366,
            1.195065859257602, 1.5146908619437442,
            1.6993573904929669, 1.36236651014713,
            0.18392189516029633, 1.0780007402035099,
            1.4776296626782237, 0.92686260915831,
            1.3686136112398444, 0.933026811288747,
            3.6179240000000004, 1.618,
            3.6168966963751688, 1.5784046040519195,
            3.6138190069116236, 1.5389719140789755,
            3.608703578495533, 1.499863967462552,
            3.601571431519515, 1.4612414671439247,
            3.592451873505335, 1.4232631212614026,
            3.5813823786730112, 1.386084990984547,
            3.56840843395121, 1.3498598492253493,
            3.553583352061695, 1.3147365528615667,
            3.536968052445921, 1.2808594310518813,
            3.5186308109339786, 1.2483676921564286,
            3.4986469791845676, 1.217394851699787,
            3.477098675048864, 1.1880681837270455,
            3.454074445130659, 1.1605081978074552,
            3.429668900929367, 1.1348281438347578,
            3.403982330061085, 1.1111335466590815,
            3.377120284155263, 1.0895217724626962,
            3.349193145120418, 1.070081628661486,
            3.3203156715611972, 1.052892998976228,
            3.2906065272106546, 1.0380265151732484,
            3.2601877933155166, 1.0255432668233437,
            3.2291844669781575, 1.015494550271633,
            3.1977239475166903, 1.00792165784987,
            3.1659355129538413, 1.0028557081973957,
            3.133949788785828, 1.0003175183879751,
            3.101898211214173, 1.0003175183879751,
            3.06991248704616, 1.0028557081973957,
            3.038124052483311, 1.0079216578498698,
            3.006663533021843, 1.015494550271633,
            2.975660206684484, 1.0255432668233437,
            2.9452414727893466, 1.0380265151732482,
            2.9155323284388035, 1.052892998976228,
            2.8866548548795827, 1.070081628661486,
            2.8587277158447377, 1.0895217724626962,
            2.8318656699389155, 1.1111335466590813,
            2.8061790990706337, 1.1348281438347576,
            2.7817735548693423, 1.160508197807455,
            2.7587493249511366, 1.1880681837270455,
            2.7372010208154336, 1.2173948516997863,
            2.717217189066022, 1.2483676921564286,
            2.6988799475540803, 1.2808594310518808,
            2.6822646479383057, 1.3147365528615667,
            2.667439566048791, 1.349859849225349,
            2.6544656213269895, 1.3860849909845467,
            2.6433961264946664, 1.4232631212614022,
            2.6342765684804856, 1.461241467143924,
            2.6271444215044677, 1.4998639674625518,
            2.622028993088377, 1.538971914078975,
            2.618951303624832, 1.5784046040519195,
            2.6179240000000004, 1.6179999999999999,
            2.925060289064675, 1.1550334716061612,
            3.1179240000000004, 1.6179999999999999,
            2.8759471874026317, 1.1384242537184899,
            2.9260565405932923, 1.1034259040965264,
            3.0427940961314737, 1.096458303288088,
            2.8679240000000004, 1.6179999999999999,
            2.9820131441529383, 1.0843271445698175,
            3.0613015357903652, 1.0510906029679994,
            3.168182776857757, 1.0910222392535693,
            3.117924000000001, 1.054747771251796,
            3.2026763472125834, 1.0564832119712533,
            3.288450665897688, 1.1392791519454843,
            3.254223955824209, 1.0833789996373708,
            3.3355915521305777, 1.1194010025904284,
            2.7974364196783963, 1.239074070841606,
            3.376061469261126, 1.1671719797643747,
            3.446147743484563, 1.2333897838699732,
            2.7633639901601152, 1.2958317199509073,
            2.769469310247206, 1.3722348793057737,
            3.4708423341715355, 1.296758226325703,
            2.6804240000000004, 1.6179999999999999,
            2.8383217118372746, 1.189812679226443,
            3.5009354531503734, 1.3576489235372837,
            2.7429240000000004, 1.6179999999999999,
            2.6955329516532363, 1.528697907268553,
            3.3679240000000004, 1.6179999999999999,
            2.7336616237547773, 1.4650222329146974,
            2.7128589782630947, 1.3865625630687441,
            3.522816094225503, 1.4237596323926138,
            3.4929240000000004, 1.6179999999999999,
            3.5382008817534794, 1.492913435309264,
            3.5467104598984367, 1.564046132302558,
            2.938771158301584, 1.3147797309770812,
            3.287789398400631, 1.3315977471206537,
            3.4026183133943273, 1.4867885217399326,
            3.390744390459814, 1.3742254516077517,
            2.8830083726407, 1.4693538562048802,
            3.112860509599274, 1.2637850895329306,
            3.2429240000000004, 1.6179999999999999,
            3.306047304019265, 1.4331439906721755,
            3.022505649719148, 1.2032870837944143,
            3.1961858813687223, 1.1952285142041486,
            2.806320044907161, 1.5366600883976667,
            2.864978937446434, 1.3755044118929922,
            3.0619231750242255, 1.446552262178491,
            3.181963569183965, 1.4030396153437035,
            3.3054240000000004, 1.536136600474709,
            3.1804240000000004, 1.5196002708766645,
            2.9848048095402424, 1.554772436499504,
            2.9666317393945563, 1.4121757719832255,
            5.235924000000001, 1.618,
            5.234261822735022, 1.5539297800192873,
            5.229282121183006, 1.4901228383154943,
            5.2210053580057725, 1.4268413712986279,
            5.209465544198576, 1.3643454160904929,
            5.1947100993316315, 1.3028917819763794,
            5.176799656692932, 1.242732995120626,
            5.155807814133057, 1.184116260882442,
            5.131820831635823, 1.1272824479960626,
            5.1049372768575, 1.0724650987894515,
            5.075267620091178, 1.0198894695087841,
            5.042933780320631, 0.9697716046922119,
            5.008068624229062, 0.9223174493965137,
            4.970815420221406, 0.8777220029246847,
            4.931327249703716, 0.8361685175319704,
            4.889766378038836, 0.7978277454030445,
            4.846303587763216, 0.762857236994654,
            4.801117476804836, 0.731400693627,
            4.754393724586017, 0.7035873769841877,
            4.706324329026839, 0.6795315779502399,
            4.657106817584506, 0.6593321469633395,
            4.606943435570659, 0.6430720878181765,
            4.556040315082004, 0.63081821658555,
            4.5046066279593155, 0.6226208870508019,
            4.452853726255469, 0.6185137837993122,
            4.400994273744532, 0.6185137837993122,
            4.349241372040686, 0.6226208870508019,
            4.297807684917997, 0.6308182165855499,
            4.246904564429342, 0.6430720878181765,
            4.196741182415495, 0.6593321469633394,
            4.147523670973163, 0.6795315779502397,
            4.099454275413984, 0.7035873769841876,
            4.052730523195165, 0.7314006936269999,
            4.007544412236786, 0.7628572369946539,
            3.9640816219611654, 0.797827745403044,
            3.922520750296285, 0.8361685175319702,
            3.8830325797785954, 0.8777220029246843,
            3.845779375770939, 0.9223174493965136,
            3.810914219679371, 0.969771604692211,
            3.778580379908824, 1.019889469508784,
            3.748910723142502, 1.072465098789451,
            3.7220271683641784, 1.1272824479960624,
            3.6980401858669434, 1.1841162608824418,
            3.677048343307069, 1.2427329951206256,
            3.6591379006683695, 1.3028917819763788,
            3.6443824558014257, 1.3643454160904918,
            3.6328426419942286, 1.4268413712986274,
            3.6245658788169943, 1.4901228383154936,
            3.619586177264978, 1.5539297800192873,
            3.6179240000000004, 1.6179999999999999,
            4.345606977310262, 0.7652746457982134,
            4.289795945666291, 0.7093909362675813,
            4.3810091879253825, 0.6948034129651138,
            4.548481675684105, 0.7740709745516935,
            4.471767741257812, 0.7082997921174864,
            4.1148769559077465, 0.8688539708601306,
            4.206392865351936, 0.7529101313616731,
            4.608915555996912, 0.7224967053664098,
            4.738971044092255, 0.868853970860133,
            5.00059528871244, 1.0966882669865676,
            4.01206712016644, 0.8915394617737089,
            4.116485670516756, 0.7853509262928552,
            4.689479966836789, 0.7732458808577173,
            4.8184389885266015, 0.8419824386892674,
            3.771535073842373, 1.2435034419661741,
            3.8154580409770964, 1.139102069803285,
            3.881731440540559, 1.050948874938082,
            3.929490111558832, 0.9543883378763929,
            4.879315309532682, 0.9251348270256188,
            4.4269240000000005, 1.6179999999999999,
            5.046434441033209, 1.1967989992267314,
            4.94546704364895, 1.0048466154128435,
            3.863135947752548, 1.2203168998676792,
            4.117924, 1.6179999999999999,
            4.735924000000001, 1.6179999999999999,
            3.8679240000000004, 1.6179999999999999,
            5.082047185630234, 1.3036881886216374,
            4.985924000000001, 1.6179999999999999,
            3.7411740232225594, 1.3550874849516712,
            5.106922027206852, 1.4155933559386655,
            5.110924000000001, 1.6179999999999999,
            3.741500750701689, 1.47323507880425,
            5.142978558578016, 1.5289560363509125,
            3.7429240000000004, 1.6179999999999999,
            4.107403351081739, 1.102474857471568,
            4.716773532382569, 1.1273311560524382,
            4.035477086964871, 1.0079710874854877,
            4.818642551378445, 1.0427914361986528,
            4.867815774060835, 1.4100258566371715,
            3.9412840294808853, 1.4136083458397362,
            5.0250820712156195, 1.5040391326840246,
            4.870022459238219, 1.2170254261224747,
            4.988056061650194, 1.3832982427421059,
            3.8325840963631412, 1.4139089465880972,
            4.860924000000001, 1.6179999999999999,
            4.909559227607785, 1.3139903031954452,
            3.886683740790506, 1.3232399129735848,
            3.8871989859059584, 1.5095571789628044,
            4.022257935111943, 1.238066583933682,
            3.9929240000000004, 1.6179999999999999,
            4.693052280259639, 0.9951022897335084,
            4.812673770081628, 1.1392442840536543,
            3.8009766738332043, 1.5450398010530142,
            4.798424000000001, 1.5118276366938377,
            4.911985004758403, 1.5146840623786015,
            4.581424, 1.4555692145490093,
            4.581424, 1.6179999999999999,
            4.716446033885695, 1.3813976298689314,
            4.797456571388061, 1.303156535355162,
            4.681884848405126, 1.5147070431684453,
            4.671988462621274, 1.2543068748821402,
            4.099766433388765, 1.3802664077086426,
            4.6082405244271, 0.8927798465776927,
            4.758794186227824, 1.2169047285738066,
            4.609864613563636, 1.347359617159507,
            4.35313258807726, 1.3377253183738098,
            4.480423886165112, 1.3711811550672879,
            4.055424, 1.5032133983747182,
            4.44128823420079, 0.9024288179561185,
            4.4616262817872565, 1.4963143082137864,
            4.4724417131639855, 1.142667287784731,
            4.549212177360188, 1.2396029269232316,
            4.43315125301444, 1.2526522026515428,
            4.593996743218767, 1.1252668255436562,
            4.269614734422847, 1.1790006976553276,
            4.516168859045161, 1.0148576844360817,
            4.372485650509893, 1.1689699056082619,
            4.305001681498116, 1.0093995922091525,
            4.438369607645691, 0.8025133224415334,
            4.522675310661661, 0.8614580134252274,
            4.343770378672707, 0.9184894022704129,
            4.607734209397187, 1.032948048114095,
            4.410798304218949, 1.003886605116684,
            4.251641028630325, 0.8827143079158033,
            4.272424000000001, 1.6179999999999999,
            4.174953671176928, 0.9895960803444541,
            4.20289611227589, 1.48693130289437,
            4.22745814657266, 1.0817125438095307,
            4.195174000000001, 1.5750031894423835,
            4.226734721148534, 1.3606945187970545,
            4.331867027549722, 1.5024917684698647,
            4.276736748417071, 1.276588287772247,
            4.149423434065589, 1.257815678626273,
            4.301864396788417, 1.4148639393643285,
            4.175989266954905, 1.1672758743205458,
            3.952156827062088, 1.1443859619208405,
            4.00812453608871, 1.3379938324350897,
            6.235924000000001, 1.618,
            6.234896696375169, 1.5784046040519195,
            6.231819006911624, 1.5389719140789755,
            6.226703578495533, 1.499863967462552,
            6.219571431519515, 1.4612414671439247,
            6.210451873505335, 1.4232631212614026,
            6.199382378673011, 1.386084990984547,
            6.18640843395121, 1.3498598492253493,
            6.171583352061695, 1.3147365528615667,
            6.154968052445921, 1.2808594310518813,
            6.136630810933979, 1.2483676921564286,
            6.116646979184568, 1.217394851699787,
            6.095098675048865, 1.1880681837270455,
            6.072074445130659, 1.1605081978074552,
            6.047668900929367, 1.1348281438347578,
            6.0219823300610855, 1.1111335466590815,
            5.995120284155263, 1.0895217724626962,
            5.967193145120419, 1.070081628661486,
            5.938315671561198, 1.052892998976228,
            5.9086065272106545, 1.0380265151732484,
            5.878187793315517, 1.0255432668233437,
            5.847184466978158, 1.015494550271633,
            5.81572394751669, 1.00792165784987,
            5.783935512953842, 1.0028557081973957,
            5.751949788785828, 1.0003175183879751,
            5.719898211214173, 1.0003175183879751,
            5.68791248704616, 1.0028557081973957,
            5.656124052483311, 1.0079216578498698,
            5.6246635330218435, 1.015494550271633,
            5.5936602066844845, 1.0255432668233437,
            5.563241472789347, 1.0380265151732482,
            5.533532328438803, 1.052892998976228,
            5.5046548548795835, 1.070081628661486,
            5.4767277158447385, 1.0895217724626962,
            5.449865669938916, 1.1111335466590813,
            5.424179099070634, 1.1348281438347576,
            5.399773554869342, 1.160508197807455,
            5.376749324951137, 1.1880681837270455,
            5.355201020815434, 1.2173948516997863,
            5.3352171890660225, 1.2483676921564286,
            5.316879947554081, 1.2808594310518808,
            5.300264647938306, 1.3147365528615667,
            5.285439566048791, 1.349859849225349,
            5.27246562132699, 1.3860849909845467,
            5.261396126494667, 1.4232631212614022,
            5.252276568480486, 1.461241467143924,
            5.2451444215044685, 1.4998639674625518,
            5.240028993088377, 1.538971914078975,
            5.236951303624832, 1.5784046040519195,
            5.235924000000001, 1.6179999999999999,
            5.543060289064676, 1.1550334716061612,
            5.735924000000001, 1.6179999999999999,
            5.493947187402632, 1.13842425371849,
            5.544056540593293, 1.1034259040965264,
            5.660794096131474, 1.096458303288088,
            5.485924000000001, 1.6179999999999999,
            5.600013144152938, 1.084327144569817,
            5.679301535790366, 1.0510906029679994,
            5.786182776857757, 1.0910222392535682,
            5.735924000000001, 1.0547477712517959,
            5.820676347212584, 1.056483211971253,
            5.906450665897689, 1.1392791519454843,
            5.872223955824209, 1.0833789996373704,
            5.953591552130578, 1.1194010025904275,
            5.415436419678397, 1.2390740708416064,
            5.994061469261125, 1.1671719797643751,
            6.064147743484564, 1.2333897838699734,
            5.381363990160115, 1.295831719950907,
            5.387469310247207, 1.3722348793057737,
            6.088842334171536, 1.2967582263257016,
            5.298424000000001, 1.6179999999999999,
            5.456321711837275, 1.1898126792264438,
            6.118935453150373, 1.3576489235372842,
            5.360924000000001, 1.6179999999999999,
            5.313532951653237, 1.5286979072685538,
            5.985924000000001, 1.6179999999999999,
            5.351661623754778, 1.4650222329146974,
            5.3308589782630955, 1.3865625630687435,
            6.140816094225503, 1.4237596323926136,
            6.110924000000001, 1.6179999999999999,
            6.15620088175348, 1.492913435309263,
            6.164710459898436, 1.5640461323025583,
            5.556771158301588, 1.3147797309770872,
            5.9057893984006355, 1.3315977471206533,
            6.020618313394329, 1.4867885217399337,
            6.008744390459817, 1.3742254516077466,
            5.501008372640699, 1.4693538562048807,
            5.7308605095992755, 1.2637850895329297,
            5.860924000000001, 1.6179999999999999,
            5.92404730401927, 1.4331439906721763,
            5.640505649719149, 1.2032870837944145,
            5.814185881368723, 1.195228514204147,
            5.4243200449071605, 1.5366600883976673,
            5.482978937446434, 1.3755044118929929,
            5.6799231750242205, 1.4465522621784983,
            5.799963569183964, 1.403039615343705,
            5.923424000000001, 1.5361366004747097,
            5.798424000000001, 1.5196002708766652,
            5.602804809540236, 1.5547724364995028,
            5.584631739394555, 1.41217577198323],

        faceTriIds : [51, 32, 31,
            205, 228, 230,
            94, 95, 78,
            32, 51, 100,
            51, 50, 83,
            132, 141, 139,
            145, 71, 158,
            100, 99, 33,
            82, 30, 85,
            98, 95, 68,
            54, 88, 25,
            64, 131, 130,
            89, 179, 185,
            27, 26, 88,
            27, 53, 101,
            122, 119, 113,
            10, 75, 115,
            101, 85, 28,
            29, 85, 30,
            63, 128, 70,
            1, 67, 148,
            99, 59, 108,
            41, 144, 42,
            74, 148, 67,
            147, 3, 2,
            42, 76, 290,
            42, 290, 43,
            75, 68, 93,
            107, 8, 97,
            84, 86, 79,
            69, 41, 40,
            285, 204, 261,
            36, 35, 108,
            70, 129, 130,
            129, 38, 37,
            64, 129, 36,
            38, 70, 39,
            81, 86, 84,
            37, 36, 129,
            71, 93, 118,
            62, 94, 66,
            146, 5, 4,
            128, 39, 70,
            106, 12, 11,
            66, 207, 62,
            102, 109, 79,
            54, 25, 24,
            41, 69, 144,
            21, 20, 56,
            66, 96, 6,
            159, 218, 105,
            54, 110, 88,
            90, 55, 54,
            77, 109, 45,
            71, 118, 158,
            17, 125, 18,
            45, 44, 77,
            53, 88, 110,
            124, 57, 56,
            128, 40, 39,
            207, 146, 235,
            127, 65, 60,
            7, 6, 96,
            75, 10, 9,
            13, 12, 71,
            103, 110, 111,
            63, 70, 130,
            56, 112, 91,
            115, 93, 106,
            55, 91, 112,
            75, 9, 107,
            15, 14, 65,
            127, 16, 15,
            52, 53, 155,
            66, 6, 5,
            18, 57, 19,
            20, 19, 124,
            125, 60, 57,
            17, 16, 60,
            1, 0, 67,
            148, 2, 1,
            90, 24, 23,
            91, 22, 21,
            205, 92, 228,
            155, 154, 52,
            133, 136, 137,
            47, 102, 86,
            99, 35, 34,
            30, 51, 31,
            67, 73, 74,
            85, 101, 52,
            0, 73, 67,
            23, 22, 55,
            56, 113, 112,
            145, 14, 13,
            51, 82, 50,
            126, 131, 136,
            97, 7, 96,
            142, 63, 139,
            87, 211, 212,
            44, 43, 290,
            87, 72, 149,
            151, 76, 142,
            68, 75, 98,
            81, 49, 48,
            48, 47, 86,
            84, 87, 149,
            80, 49, 81,
            30, 82, 51,
            202, 82, 52,
            99, 83, 59,
            100, 83, 99,
            84, 79, 87,
            80, 81, 84,
            28, 85, 29,
            52, 82, 85,
            48, 86, 81,
            47, 46, 102,
            150, 209, 152,
            63, 132, 139,
            27, 88, 53,
            25, 88, 26,
            103, 111, 156,
            123, 89, 156,
            24, 90, 54,
            23, 55, 90,
            22, 91, 55,
            21, 56, 91,
            235, 3, 147,
            147, 2, 148,
            218, 219, 157,
            106, 93, 71,
            95, 94, 62,
            78, 97, 96,
            207, 235, 206,
            191, 222, 252,
            66, 94, 96,
            78, 96, 94,
            78, 98, 107,
            7, 97, 8,
            98, 75, 107,
            95, 98, 78,
            59, 64, 108,
            33, 99, 34,
            32, 100, 33,
            51, 83, 100,
            27, 101, 28,
            52, 101, 53,
            46, 45, 109,
            79, 86, 102,
            111, 54, 55,
            156, 217, 103,
            113, 104, 112,
            65, 145, 158,
            167, 163, 164,
            104, 113, 119,
            12, 106, 71,
            11, 10, 115,
            8, 107, 9,
            107, 97, 78,
            36, 108, 64,
            35, 99, 108,
            109, 77, 209,
            46, 109, 102,
            111, 110, 54,
            155, 110, 103,
            112, 111, 55,
            156, 111, 104,
            113, 56, 57,
            111, 112, 104,
            60, 116, 57,
            113, 57, 116,
            93, 219, 118,
            159, 158, 114,
            93, 115, 75,
            11, 115, 106,
            160, 60, 65,
            119, 120, 117,
            105, 165, 167,
            119, 123, 104,
            219, 93, 68,
            158, 118, 114,
            122, 116, 120,
            117, 121, 123,
            116, 60, 160,
            120, 162, 161,
            170, 164, 166,
            132, 63, 130,
            116, 122, 113,
            120, 119, 122,
            117, 123, 119,
            89, 123, 121,
            20, 124, 56,
            19, 57, 124,
            18, 125, 57,
            17, 60, 125,
            137, 59, 83,
            188, 190, 189,
            16, 127, 60,
            15, 65, 127,
            63, 69, 128,
            40, 128, 69,
            130, 129, 64,
            38, 129, 70,
            131, 64, 59,
            132, 130, 126,
            59, 137, 136,
            126, 130, 131,
            140, 132, 126,
            63, 142, 144,
            203, 199, 201,
            172, 175, 121,
            194, 138, 195,
            170, 166, 117,
            141, 143, 186,
            208, 87, 79,
            59, 136, 131,
            133, 198, 200,
            83, 50, 137,
            201, 137, 50,
            200, 198, 195,
            143, 141, 138,
            132, 140, 141,
            142, 139, 135,
            140, 126, 195,
            140, 138, 141,
            143, 138, 193,
            135, 139, 141,
            151, 150, 152,
            144, 142, 76,
            216, 211, 153,
            212, 72, 87,
            42, 144, 76,
            63, 144, 69,
            14, 145, 65,
            13, 71, 145,
            5, 146, 66,
            235, 4, 3,
            74, 147, 148,
            262, 228, 92,
            72, 80, 149,
            84, 149, 80,
            152, 76, 151,
            135, 141, 186,
            142, 135, 151,
            135, 190, 192,
            209, 150, 208,
            152, 77, 290,
            150, 192, 211,
            212, 216, 210,
            121, 179, 89,
            202, 201, 50,
            110, 155, 53,
            155, 103, 217,
            123, 156, 104,
            156, 89, 217,
            256, 257, 95,
            95, 62, 234,
            114, 218, 159,
            160, 158, 159,
            161, 159, 105,
            160, 159, 162,
            116, 160, 120,
            65, 158, 160,
            164, 161, 105,
            117, 120, 161,
            161, 162, 159,
            120, 160, 162,
            223, 252, 224,
            173, 176, 175,
            105, 218, 165,
            164, 163, 166,
            256, 259, 255,
            167, 165, 169,
            174, 291, 173,
            117, 166, 172,
            105, 167, 164,
            254, 226, 253,
            264, 244, 223,
            167, 169, 163,
            256, 258, 259,
            253, 250, 169,
            117, 161, 170,
            164, 170, 161,
            180, 196, 194,
            117, 172, 121,
            174, 172, 166,
            174, 175, 172,
            291, 174, 163,
            169, 250, 163,
            163, 174, 166,
            174, 173, 175,
            181, 176, 178,
            121, 175, 179,
            292, 176, 173,
            178, 176, 171,
            171, 183, 178,
            203, 202, 154,
            184, 180, 183,
            181, 179, 175,
            175, 176, 181,
            179, 221, 185,
            193, 194, 196,
            183, 197, 178,
            177, 221, 178,
            217, 185, 154,
            178, 221, 181,
            177, 198, 199,
            184, 183, 171,
            183, 180, 197,
            220, 292, 291,
            275, 276, 244,
            221, 179, 181,
            185, 182, 203,
            189, 186, 143,
            190, 135, 186,
            143, 222, 189,
            187, 189, 191,
            215, 153, 187,
            151, 192, 150,
            143, 193, 222,
            188, 189, 187,
            189, 190, 186,
            190, 188, 192,
            196, 224, 134,
            213, 215, 237,
            192, 151, 135,
            211, 192, 188,
            193, 138, 194,
            222, 193, 134,
            138, 140, 195,
            197, 177, 178,
            200, 126, 136,
            133, 199, 198,
            224, 180, 184,
            193, 196, 134,
            180, 194, 197,
            195, 197, 194,
            177, 197, 198,
            195, 198, 197,
            133, 137, 201,
            199, 182, 221,
            126, 200, 195,
            133, 200, 136,
            82, 202, 50,
            133, 201, 199,
            52, 154, 202,
            154, 185, 203,
            199, 203, 182,
            201, 202, 203,
            204, 225, 233,
            253, 168, 250,
            231, 74, 230,
            231, 232, 206,
            147, 74, 236,
            73, 205, 230,
            146, 207, 66,
            234, 207, 206,
            209, 208, 79,
            211, 208, 150,
            109, 209, 79,
            152, 209, 77,
            153, 211, 188,
            216, 153, 215,
            211, 87, 208,
            188, 187, 153,
            214, 72, 212,
            237, 187, 191,
            213, 242, 249,
            237, 215, 187,
            212, 210, 214,
            216, 215, 213,
            216, 213, 249,
            216, 212, 211,
            185, 217, 89,
            155, 217, 154,
            219, 218, 114,
            165, 218, 157,
            118, 219, 114,
            219, 68, 257,
            271, 266, 270,
            251, 265, 171,
            199, 221, 177,
            185, 221, 182,
            252, 222, 134,
            189, 222, 191,
            241, 243, 244,
            237, 242, 213,
            180, 224, 196,
            264, 224, 184,
            234, 206, 232,
            204, 285, 287,
            169, 254, 253,
            285, 261, 283,
            233, 225, 232,
            227, 262, 233,
            230, 228, 227,
            229, 283, 261,
            233, 261, 204,
            231, 230, 227,
            230, 74, 73,
            232, 231, 227,
            231, 206, 236,
            232, 227, 233,
            232, 225, 234,
            262, 227, 228,
            261, 262, 263,
            95, 234, 225,
            234, 62, 207,
            235, 146, 4,
            236, 235, 147,
            231, 236, 74,
            235, 236, 206,
            276, 288, 241,
            240, 191, 252,
            240, 237, 191,
            243, 245, 240,
            242, 61, 249,
            243, 240, 223,
            245, 248, 239,
            242, 237, 247,
            247, 237, 240,
            246, 61, 242,
            244, 243, 223,
            243, 241, 245,
            265, 269, 264,
            266, 275, 269,
            248, 245, 241,
            246, 245, 239,
            240, 245, 247,
            245, 246, 242,
            242, 247, 245,
            277, 276, 275,
            238, 239, 248,
            61, 210, 249,
            216, 249, 210,
            250, 168, 271,
            163, 250, 220,
            171, 176, 292,
            251, 270, 266,
            224, 252, 134,
            240, 252, 223,
            254, 169, 165,
            226, 287, 286,
            157, 255, 165,
            254, 165, 255,
            157, 256, 255,
            258, 256, 95,
            257, 256, 157,
            258, 95, 225,
            219, 257, 157,
            95, 257, 68,
            225, 204, 260,
            255, 259, 254,
            258, 225, 260,
            226, 254, 259,
            226, 259, 260,
            260, 259, 258,
            282, 268, 284,
            261, 263, 229,
            233, 262, 261,
            224, 264, 223,
            262, 92, 263,
            265, 264, 184,
            171, 265, 184,
            251, 266, 269,
            220, 271, 270,
            274, 271, 168,
            275, 266, 273,
            278, 276, 277,
            275, 273, 277,
            253, 286, 168,
            264, 269, 244,
            251, 269, 265,
            270, 251, 292,
            220, 250, 271,
            253, 226, 286,
            266, 271, 273,
            283, 284, 268,
            279, 280, 267,
            274, 273, 271,
            279, 267, 277,
            286, 274, 168,
            273, 274, 272,
            278, 277, 267,
            275, 244, 269,
            281, 272, 279,
            244, 276, 241,
            267, 238, 278,
            288, 248, 241,
            278, 238, 288,
            281, 279, 277,
            272, 289, 282,
            277, 273, 281,
            279, 58, 280,
            272, 281, 273,
            58, 279, 282,
            272, 282, 279,
            282, 284, 58,
            283, 268, 285,
            285, 289, 286,
            283, 229, 284,
            260, 287, 226,
            289, 285, 268,
            274, 286, 272,
            204, 287, 260,
            286, 287, 285,
            278, 288, 276,
            238, 248, 288,
            282, 289, 268,
            272, 286, 289,
            152, 290, 76,
            44, 290, 77,
            163, 220, 291,
            220, 270, 292,
            171, 292, 251,
            173, 291, 292,
            324, 346, 325,
            301, 362, 302,
            304, 303, 359,
            346, 345, 326,
            325, 346, 326,
            377, 378, 371,
            341, 340, 367,
            345, 327, 326,
            345, 346, 343,
            386, 357, 375,
            349, 350, 347,
            358, 308, 307,
            309, 308, 356,
            320, 319, 350,
            321, 320, 350,
            306, 358, 307,
            371, 373, 377,
            323, 349, 346,
            349, 321, 350,
            367, 363, 341,
            359, 362, 378,
            328, 345, 364,
            332, 360, 333,
            385, 367, 369,
            367, 339, 338,
            334, 360, 370,
            335, 334, 370,
            371, 299, 298,
            367, 366, 363,
            336, 335, 370,
            334, 333, 360,
            373, 297, 296,
            329, 328, 364,
            339, 367, 340,
            364, 375, 357,
            358, 376, 354,
            330, 357, 331,
            295, 294, 374,
            364, 330, 329,
            360, 361, 370,
            300, 365, 301,
            330, 364, 357,
            357, 360, 332,
            365, 299, 371,
            338, 369, 367,
            338, 337, 369,
            316, 353, 352,
            299, 365, 300,
            315, 353, 316,
            311, 355, 312,
            298, 297, 371,
            346, 349, 343,
            355, 353, 313,
            355, 313, 312,
            314, 313, 353,
            355, 311, 356,
            382, 389, 390,
            356, 311, 310,
            358, 306, 359,
            316, 352, 317,
            354, 355, 356,
            356, 308, 358,
            328, 327, 345,
            352, 318, 317,
            319, 318, 350,
            306, 305, 359,
            356, 310, 309,
            350, 352, 347,
            347, 352, 351,
            362, 303, 302,
            365, 362, 301,
            321, 349, 322,
            336, 370, 337,
            293, 374, 294,
            358, 354, 356,
            351, 352, 353,
            353, 315, 314,
            383, 375, 343,
            359, 376, 358,
            359, 303, 362,
            375, 364, 343,
            324, 323, 346,
            345, 343, 364,
            368, 377, 372,
            379, 348, 385,
            332, 331, 357,
            363, 342, 341,
            353, 355, 351,
            380, 384, 376,
            373, 371, 297,
            383, 347, 384,
            360, 357, 386,
            349, 323, 322,
            374, 293, 372,
            349, 347, 383,
            352, 350, 318,
            355, 354, 384,
            359, 305, 304,
            369, 361, 379,
            366, 367, 385,
            361, 369, 370,
            337, 370, 369,
            295, 373, 296,
            377, 373, 374,
            374, 373, 295,
            343, 349, 383,
            377, 374, 372,
            379, 392, 391,
            362, 365, 378,
            379, 391, 348,
            387, 388, 390,
            376, 359, 378,
            371, 378, 365,
            368, 389, 377,
            361, 386, 379,
            386, 392, 379,
            384, 351, 355,
            382, 388, 376,
            381, 344, 390,
            378, 382, 376,
            377, 382, 378,
            377, 389, 382,
            384, 347, 351,
            375, 383, 380,
            376, 384, 354,
            383, 384, 380,
            366, 385, 348,
            369, 379, 385,
            360, 386, 361,
            392, 386, 375,
            380, 387, 392,
            380, 376, 388,
            380, 388, 387,
            368, 381, 389,
            389, 381, 390,
            387, 390, 344,
            390, 388, 382,
            387, 344, 391,
            344, 348, 391,
            380, 392, 375,
            391, 392, 387,
            423, 449, 454,
            538, 491, 465,
            437, 436, 457,
            454, 426, 425,
            454, 453, 426,
            405, 461, 406,
            528, 479, 448,
            453, 427, 426,
            449, 423, 422,
            428, 460, 429,
            419, 418, 445,
            461, 407, 406,
            408, 407, 456,
            420, 445, 444,
            419, 445, 420,
            538, 458, 459,
            460, 453, 479,
            420, 444, 421,
            449, 422, 444,
            451, 461, 480,
            486, 490, 495,
            428, 427, 453,
            434, 433, 458,
            485, 483, 497,
            397, 396, 472,
            457, 435, 458,
            445, 521, 443,
            475, 394, 393,
            441, 474, 476,
            471, 438, 437,
            458, 465, 457,
            474, 440, 439,
            428, 453, 460,
            399, 398, 469,
            402, 401, 452,
            429, 460, 430,
            431, 460, 459,
            400, 399, 463,
            514, 516, 503,
            432, 458, 433,
            459, 458, 432,
            431, 459, 432,
            452, 463, 484,
            441, 440, 474,
            403, 452, 464,
            471, 439, 438,
            445, 443, 444,
            464, 461, 405,
            447, 445, 417,
            410, 455, 411,
            449, 448, 454,
            415, 414, 450,
            447, 450, 446,
            455, 505, 446,
            461, 464, 480,
            450, 414, 413,
            423, 454, 424,
            455, 410, 456,
            456, 410, 409,
            457, 436, 435,
            401, 463, 452,
            425, 424, 454,
            404, 403, 464,
            455, 412, 411,
            413, 412, 450,
            461, 456, 407,
            479, 459, 460,
            455, 450, 412,
            435, 434, 458,
            402, 452, 403,
            463, 401, 400,
            443, 449, 444,
            460, 431, 430,
            472, 469, 397,
            395, 394, 475,
            522, 521, 446,
            415, 447, 416,
            399, 469, 463,
            493, 451, 480,
            456, 461, 451,
            475, 396, 395,
            456, 409, 408,
            447, 417, 416,
            463, 469, 488,
            471, 474, 439,
            422, 421, 444,
            494, 452, 484,
            404, 464, 405,
            443, 521, 523,
            486, 474, 471,
            418, 417, 445,
            398, 397, 469,
            451, 455, 456,
            450, 455, 446,
            453, 454, 448,
            415, 450, 447,
            455, 451, 505,
            445, 447, 521,
            472, 485, 469,
            437, 457, 471,
            475, 473, 483,
            457, 465, 489,
            489, 486, 471,
            472, 475, 483,
            393, 473, 475,
            476, 442, 441,
            483, 473, 470,
            396, 475, 472,
            525, 523, 511,
            495, 476, 474,
            531, 529, 533,
            506, 478, 494,
            478, 503, 516,
            448, 479, 453,
            477, 491, 538,
            452, 480, 464,
            480, 478, 493,
            497, 481, 485,
            478, 480, 494,
            489, 465, 491,
            510, 490, 482,
            509, 507, 498,
            470, 487, 497,
            488, 469, 485,
            484, 488, 501,
            483, 485, 472,
            488, 485, 481,
            471, 457, 489,
            490, 486, 482,
            467, 496, 487,
            496, 481, 497,
            501, 481, 500,
            463, 488, 484,
            538, 465, 458,
            482, 486, 489,
            510, 482, 504,
            468, 476, 495,
            489, 491, 539,
            504, 482, 539,
            468, 490, 492,
            507, 514, 503,
            451, 493, 505,
            452, 494, 480,
            506, 484, 501,
            486, 495, 474,
            468, 495, 490,
            502, 499, 498,
            502, 496, 467,
            470, 497, 483,
            487, 496, 497,
            462, 527, 533,
            496, 500, 481,
            512, 499, 462,
            500, 496, 502,
            484, 506, 494,
            481, 501, 488,
            501, 500, 503,
            499, 502, 467,
            500, 502, 498,
            498, 507, 500,
            503, 500, 507,
            537, 535, 491,
            533, 512, 462,
            446, 505, 522,
            501, 503, 506,
            478, 506, 503,
            508, 509, 512,
            509, 508, 515,
            517, 534, 535,
            525, 513, 519,
            512, 509, 498,
            515, 514, 509,
            466, 492, 510,
            510, 492, 490,
            524, 493, 478,
            525, 511, 518,
            499, 512, 498,
            520, 526, 523,
            515, 519, 513,
            505, 493, 524,
            509, 514, 507,
            514, 513, 516,
            534, 519, 515,
            513, 514, 515,
            516, 513, 518,
            478, 516, 524,
            519, 534, 517,
            520, 528, 526,
            525, 519, 520,
            518, 511, 522,
            534, 515, 508,
            517, 530, 519,
            530, 477, 528,
            526, 448, 449,
            446, 521, 447,
            523, 521, 511,
            518, 522, 505,
            521, 522, 511,
            531, 510, 529,
            504, 529, 510,
            516, 518, 524,
            505, 524, 518,
            513, 525, 518,
            523, 525, 520,
            443, 526, 449,
            520, 530, 528,
            479, 528, 477,
            443, 523, 526,
            448, 526, 528,
            504, 532, 529,
            536, 512, 533,
            519, 530, 520,
            530, 517, 537,
            527, 466, 531,
            510, 531, 466,
            539, 535, 504,
            536, 532, 508,
            531, 533, 527,
            529, 532, 536,
            508, 532, 534,
            535, 534, 532,
            504, 535, 532,
            491, 477, 537,
            512, 536, 508,
            529, 536, 533,
            530, 537, 477,
            517, 535, 537,
            459, 479, 538,
            477, 538, 479,
            489, 539, 482,
            535, 539, 491,
            593, 572, 571,
            548, 609, 549,
            551, 550, 606,
            573, 593, 592,
            572, 593, 573,
            624, 625, 618,
            588, 587, 614,
            592, 574, 573,
            592, 593, 590,
            633, 604, 622,
            596, 597, 594,
            605, 555, 554,
            556, 555, 603,
            567, 566, 597,
            568, 567, 597,
            553, 605, 554,
            618, 620, 624,
            570, 596, 593,
            596, 568, 597,
            614, 610, 588,
            606, 609, 625,
            575, 592, 611,
            579, 607, 580,
            632, 614, 616,
            614, 586, 585,
            581, 607, 617,
            582, 581, 617,
            618, 546, 545,
            614, 613, 610,
            583, 582, 617,
            581, 580, 607,
            620, 544, 543,
            576, 575, 611,
            586, 614, 587,
            611, 622, 604,
            605, 623, 601,
            577, 604, 578,
            542, 541, 621,
            611, 577, 576,
            607, 608, 617,
            547, 612, 548,
            577, 611, 604,
            604, 607, 579,
            612, 546, 618,
            585, 616, 614,
            585, 584, 616,
            563, 600, 599,
            546, 612, 547,
            562, 600, 563,
            558, 602, 559,
            545, 544, 618,
            593, 596, 590,
            602, 600, 560,
            602, 560, 559,
            561, 560, 600,
            602, 558, 603,
            629, 636, 637,
            603, 558, 557,
            605, 553, 606,
            563, 599, 564,
            601, 602, 603,
            603, 555, 605,
            575, 574, 592,
            599, 565, 564,
            566, 565, 597,
            553, 552, 606,
            603, 557, 556,
            597, 599, 594,
            594, 599, 598,
            549, 609, 550,
            612, 609, 548,
            568, 596, 569,
            583, 617, 584,
            540, 621, 541,
            605, 601, 603,
            598, 599, 600,
            600, 562, 561,
            590, 630, 622,
            606, 623, 605,
            609, 606, 550,
            622, 611, 590,
            571, 570, 593,
            592, 590, 611,
            615, 624, 619,
            626, 595, 632,
            579, 578, 604,
            610, 589, 588,
            602, 598, 600,
            627, 631, 623,
            620, 618, 544,
            630, 594, 631,
            607, 604, 633,
            596, 570, 569,
            619, 621, 540,
            596, 594, 630,
            599, 597, 565,
            602, 601, 631,
            606, 552, 551,
            616, 608, 626,
            613, 614, 632,
            608, 616, 617,
            584, 617, 616,
            542, 620, 543,
            624, 620, 621,
            621, 620, 542,
            590, 596, 630,
            624, 621, 619,
            626, 639, 638,
            609, 612, 625,
            626, 638, 595,
            634, 635, 637,
            623, 606, 625,
            618, 625, 612,
            615, 636, 624,
            608, 633, 626,
            633, 639, 626,
            631, 598, 602,
            629, 635, 623,
            628, 591, 637,
            625, 629, 623,
            624, 629, 625,
            624, 636, 629,
            631, 594, 598,
            622, 630, 627,
            623, 631, 601,
            630, 631, 627,
            613, 632, 595,
            616, 626, 632,
            607, 633, 608,
            639, 633, 622,
            627, 634, 639,
            627, 623, 635,
            627, 635, 634,
            615, 628, 636,
            636, 628, 637,
            634, 637, 591,
            637, 635, 629,
            634, 591, 638,
            591, 595, 638,
            627, 639, 622,
            638, 639, 634]
    }
];


        initThreeScene();
        onWindowResize();
        initPhysics();
        update();</script>
    <script>
        let isRunning = false;

        document.getElementById('buttonRun').addEventListener('click', () => {
            isRunning = !isRunning;
            updateRunButton();
            updateExportButton();
        });

        document.getElementById('buttonRestart').addEventListener('click', () => {
            isRunning = false;
            updateRunButton();
            updateExportButton();
        });

        function updateRunButton() {
            const runButton = document.getElementById('buttonRun');
            runButton.textContent = isRunning ? 'Pause' : 'Run';
        }

        function updateExportButton() {
            const exportButton = document.getElementById('buttonExport');
            if (isRunning) {
                exportButton.classList.add('disabled');
                exportButton.disabled = true;
            } else {
                exportButton.classList.remove('disabled');
                exportButton.disabled = false;
            }
        }

        // Initialize the buttons state
        updateRunButton();
        updateExportButton();
    </script>
    <br><br>		
</body>
</html>
